#!/bin/bash
#############################################################
#
# V2ray for Alwaysdata.com
# Author: ifeng, <https://t.me/HiaiFeng>
# Web Site: https://www.hicairo.com
#
#############################################################

TMP_DIRECTORY=$(mktemp -d)

UUID=$(grep -o 'UUID=[^ ]*' $HOME/admin/config/apache/sites.conf | sed 's/UUID=//')
VMESS_WSPATH=$(grep -o 'VMESS_WSPATH=[^ ]*' $HOME/admin/config/apache/sites.conf | sed 's/VMESS_WSPATH=//')
VLESS_WSPATH=$(grep -o 'VLESS_WSPATH=[^ ]*' $HOME/admin/config/apache/sites.conf | sed 's/VLESS_WSPATH=//')

UUID=${UUID:-'de04add9-5c68-8bab-950c-08cd5320df18'}
VMESS_WSPATH=${VMESS_WSPATH:-'/vmess'}
VLESS_WSPATH=${VLESS_WSPATH:-'/vless'}
URL=${USER}.alwaysdata.net
NEZHA_SERVER=nezha-kwxos.fly.dev
NEZHA_PORT=5555
NEZHA_KEY=IBzioUyDii0TNqr860

wget -q -O $TMP_DIRECTORY/config.json https://raw.githubusercontent.com/hiifeng/V2ray-for-AlwaysData/main/config.json
wget -q -O $TMP_DIRECTORY/v2ray-linux-64.zip https://github.com/v2fly/v2ray-core/releases/download/v4.45.0/v2ray-linux-64.zip
unzip -oq -d $HOME $TMP_DIRECTORY/v2ray-linux-64.zip v2ray v2ctl geoip.dat geosite.dat geoip-only-cn-private.dat

sed -i "s#UUID#$UUID#g;s#VMESS_WSPATH#$VMESS_WSPATH#g;s#VLESS_WSPATH#$VLESS_WSPATH#g;s#10000#8300#g;s#20000#8400#g;s#127.0.0.1#0.0.0.0#g" $TMP_DIRECTORY/config.json
cp $TMP_DIRECTORY/config.json $HOME
rm -rf $HOME/admin/tmp/*.*

Advanced_Settings=$(cat <<-EOF
#UUID=${UUID}
#VMESS_WSPATH=${VMESS_WSPATH}
#VLESS_WSPATH=${VLESS_WSPATH}

ProxyRequests off
ProxyPreserveHost On
ProxyPass "${VMESS_WSPATH}" "ws://services-${USER}.alwaysdata.net:8300${VMESS_WSPATH}"
ProxyPassReverse "${VMESS_WSPATH}" "ws://services-${USER}.alwaysdata.net:8300${VMESS_WSPATH}"
ProxyPass "${VLESS_WSPATH}" "ws://services-${USER}.alwaysdata.net:8400${VLESS_WSPATH}"
ProxyPassReverse "${VLESS_WSPATH}" "ws://services-${USER}.alwaysdata.net:8400${VLESS_WSPATH}"
EOF
)

vmlink=vmess://$(echo -n "{\"v\":\"2\",\"ps\":\"hicairo.com\",\"add\":\"$URL\",\"port\":\"443\",\"id\":\"$UUID\",\"aid\":\"0\",\"net\":\"ws\",\"type\":\"none\",\"host\":\"$URL\",\"path\":\"$VMESS_WSPATH\",\"tls\":\"tls\"}" | base64 -w 0)
vllink="vless://"$UUID"@"$URL":443?encryption=none&security=tls&type=ws&host="$URL"&path="$VLESS_WSPATH"#hicairo.com"

qrencode -o $HOME/www/M$UUID.png $vmlink
qrencode -o $HOME/www/L$UUID.png $vllink

Author=$(cat <<-EOF
#############################################################
#
# V2ray for Alwaysdata.com
# Author: ifeng, <https://t.me/HiaiFeng>
# Web Site: https://www.hicairo.com
#
#############################################################
EOF
)

cat > $HOME/www/index.html<<-EOF
<html lang="zh-cmn-Hans">
<head>
    <meta charset="utf-8">
    <title>静雨·安蝉の个人主页</title>
	<link rel="shortcut icon" href="https://blog.kwxos.top/assets/img/favico1n.png" /> 
    <meta name="author" content="iami">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="HandheldFriendly" content="true">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <link rel="stylesheet" type="text/css" href="https://kwxos.top/style/css/main.css">

</head>
<body>

<div class="content-container">
	<img class="avatar" src="https://blog.kwxos.top/my/1.png"/>
	<div class="text part1">
		<div>
			<span class="letter"><div class="character">J</div> <span></span></span>
			<span class="letter"><div class="character"></div> <span></span></span>
			<span class="letter"><div class="character">Y</div> <span></span></span>
			<span class="letter"><div class="character">A</div> <span></span></span>
			<span class="letter"><div class="character"></div> <span></span></span>
			<span class="letter"><div class="character">C</div> <span></span></span>
		</div>
	</div>    
	<span class="bio">
        <span style="transition-delay:2s" class="emphasis">我</span>
        <span style="transition-delay:.5s">喜欢</span>
        <span style="transition-delay:1s">天空</span>
        <span style="transition-delay:1.5s">的</span>
        <span style="transition-delay:2s">颜色</span>
        <span style="transition-delay:2.5s">风</span>
        <span style="transition-delay:3s">的</span>
        <span style="transition-delay:3.5s">味道</span>
		<span style="transition-delay:4s">大海</span>
        <span style="transition-delay:4.5s">的</span>
        <span style="transition-delay:5s">深度</span>
		<span style="transition-delay:5.5s">和</span>
		<span style="transition-delay:6s"  class="emphasis">你</span>
		<span style="transition-delay:6.5s">的</span>
		<span style="transition-delay:7s">声音.</span>
    </span>
    <ul>
		<li>
			<a href="https://blog.kwxos.top" target="_blank">
				<svg t="1662438013191" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7457" width="50px"><path d="M746.500337 444.954001l-39.047318 0c-7.852852 0-14.527878-3.227508-19.806091-9.903557-5.41022-6.588045-8.15882-14.44192-8.15882-23.559579 0-46.332235-16.316617-85.859483-48.950875-118.449739-32.722262-32.67826-72.249511-49.082882-118.581746-49.082882l-100.519368 0c-46.332235 0-85.773526 16.404622-118.449739 49.082882-32.67826 32.590256-49.082882 72.117504-49.082882 118.449739l0 201.01827c0 46.332235 16.404622 85.881996 49.082882 118.559233 32.676214 32.69975 72.117504 48.994877 118.449739 48.994877l201.125717 0c46.334281 0 85.773526-16.295128 118.451786-48.994877 32.67826-32.67826 49.080835-72.226998 49.080835-118.559233L780.094456 478.547097c0-9.140171-3.315512-16.991999-10.033517-23.668049C763.514849 448.313515 755.661997 444.954001 746.500337 444.954001zM388.575458 391.18233c7.066953-8.748245 15.399735-13.154601 25.12933-13.154601l107.281375 0c9.643638 0 18.063401 4.40738 25.131377 13.154601 7.02295 8.834202 10.600429 19.327184 10.600429 31.498388 0 12.08627-3.577478 22.578228-10.600429 31.41243-7.066953 8.834202-15.487739 13.240559-25.131377 13.240559L413.703765 467.333708c-9.729595 0-18.061354-4.40738-25.12933-13.240559-7.068999-8.834202-10.602476-19.327184-10.602476-31.41243C377.971959 410.509515 381.505435 400.016533 388.575458 391.18233zM636.121414 632.81767c-6.719028 8.855692-14.527878 13.263072-23.559579 13.263072L411.435095 646.080741c-9.031701 0-16.97051-4.40738-23.559579-13.263072-6.544043-8.81169-9.903557-19.327184-9.903557-31.498388 0-12.063757 3.359514-22.578228 9.903557-31.41243 6.589069-8.813736 14.527878-13.240559 23.559579-13.240559l201.125717 0c9.031701 0 16.84055 4.426823 23.559579 13.240559 6.544043 8.834202 9.903557 19.348674 9.903557 31.41243C646.024971 613.490485 642.664434 624.004957 636.121414 632.81767zM780.093433 65.213257 243.903497 65.213257c-98.642624 0-178.61298 80.101339-178.61298 178.744987l0 536.105001c0 98.730629 79.969333 178.722474 178.61298 178.722474l536.190959 0c98.642624 0 178.615027-79.991846 178.615027-178.722474L958.709483 243.958244C958.70846 145.31562 878.73708 65.213257 780.093433 65.213257zM869.401458 735.387743c0 74.015737-59.989279 133.983527-134.069485 133.983527L288.667004 869.37127c-74.082252 0-134.115534-59.96779-134.115534-133.983527l0-446.775486c0-74.015737 60.033281-133.961014 134.115534-133.961014l446.664969 0c74.080206 0 134.069485 59.945277 134.069485 133.961014L869.401458 735.387743z" p-id="7458"></path></svg>		</a>
			
		</li>
		<li>
			<a href="https://short.openos.ga" target="_blank">
				<svg t="1672231346947" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2836" width="50px"><path d="M512 1024C229.228 1024 0 794.772 0 512S229.228 0 512 0s512 229.228 512 512-229.228 512-512 512z m54.545-565.02l-1.798-1.764a102.207 102.207 0 0 0-11.002-9.523l-35.453 35.442c4.176 2.446 8.078 5.393 11.605 8.92l1.866 1.763a58.277 58.277 0 0 1 0 82.341l-96.904 96.882a58.334 58.334 0 0 1-82.341 0l-1.832-1.798a58.243 58.243 0 0 1 0-82.306l43.816-43.828a149.675 149.675 0 0 1-10.866-58.732l-67.812 67.72c-41.836 41.825-41.836 110.251 0 152.053l1.787 1.798c41.836 41.79 110.228 41.79 152.052 0l96.882-96.916c41.757-41.825 41.757-110.25 0-152.052z m141.38-141.37l-1.82-1.797c-41.802-41.825-110.228-41.825-152.053 0l-96.882 96.916c-41.824 41.79-41.824 110.216 0 152.053l1.798 1.763c3.505 3.425 7.225 6.576 11.002 9.523l35.454-35.476a57.845 57.845 0 0 1-11.583-8.92l-1.798-1.763a58.311 58.311 0 0 1 0-82.375l96.905-96.882a58.197 58.197 0 0 1 82.284 0l1.798 1.797a58.277 58.277 0 0 1 0 82.341l-43.76 43.828c7.612 18.796 11.196 38.81 10.844 58.766l67.789-67.755c41.824-41.79 41.824-110.216 0.022-152.007z" p-id="2837"></path></svg></a>
		</li>
		<li>
			<a href="https://github.com/kwxos" target="_blank">
				<svg t="1662436855417" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2360" width="50px"><path d="M512 85.333333C276.266667 85.333333 85.333333 276.266667 85.333333 512a426.410667 426.410667 0 0 0 291.754667 404.821333c21.333333 3.712 29.312-9.088 29.312-20.309333 0-10.112-0.554667-43.690667-0.554667-79.445333-107.178667 19.754667-134.912-26.112-143.445333-50.133334-4.821333-12.288-25.6-50.133333-43.733333-60.288-14.933333-7.978667-36.266667-27.733333-0.554667-28.245333 33.621333-0.554667 57.6 30.933333 65.621333 43.733333 38.4 64.512 99.754667 46.378667 124.245334 35.2 3.754667-27.733333 14.933333-46.378667 27.221333-57.045333-94.933333-10.666667-194.133333-47.488-194.133333-210.688 0-46.421333 16.512-84.778667 43.733333-114.688-4.266667-10.666667-19.2-54.4 4.266667-113.066667 0 0 35.712-11.178667 117.333333 43.776a395.946667 395.946667 0 0 1 106.666667-14.421333c36.266667 0 72.533333 4.778667 106.666666 14.378667 81.578667-55.466667 117.333333-43.690667 117.333334-43.690667 23.466667 58.666667 8.533333 102.4 4.266666 113.066667 27.178667 29.866667 43.733333 67.712 43.733334 114.645333 0 163.754667-99.712 200.021333-194.645334 210.688 15.445333 13.312 28.8 38.912 28.8 78.933333 0 57.045333-0.554667 102.912-0.554666 117.333334 0 11.178667 8.021333 24.490667 29.354666 20.224A427.349333 427.349333 0 0 0 938.666667 512c0-235.733333-190.933333-426.666667-426.666667-426.666667z" fill="#000000" p-id="2361"></path></svg></a>
		</li>
		<li>
			<a href="https://api.kwxos.top" target="_blank">
				<svg t="1662437109226" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6508" width="50px"><path d="M0 651.84768c0 92.3904 69.16608 169.05216 159.9744 183.84896l32.0256 2.56h316.78976l6.4256-0.88576 316.79488 0.88576 32.02048-2.56c90.8032-14.7968 159.96928-91.45856 159.96928-183.84896 0-81.1776-53.43232-150.25152-128.04608-175.85152-2.69824-160.768-137.77408-290.25792-303.94368-290.25792-119.85408 0-223.50848 67.3536-273.03424 165.23776-23.40864-25.13408-57.2928-40.96-94.99648-40.96-70.70208 0-128 55.66976-128 124.27264 0 17.92 3.91168 34.95936 10.89024 50.36032C43.56608 515.0976 0 578.53952 0 651.84768z m159.9744-150.8096l-15.36-40.26368a57.82528 57.82528 0 0 1-5.4016-24.52992c0-33.41824 33.792-83.08736 86.8096-83.08736 18.2016 0 39.51616 9.07776 51.712 21.97504l50.03776 34.76992 42.54208-56.73984c48.17408-71.81824 129.44384-121.20064 221.09184-121.20064 129.2544 0 256.83968 123.20256 258.88256 246.36416v43.65824l45.00992 12.05248c50.7392 17.08032 84.76672 63.0272 84.76672 114.31424 0 59.43808-60.88704 133.9136-122.22976 143.68768h-342.71744v0.36864h-6.4256v-0.36864H194.23744l-21.22752-1.67424c-61.34784-9.7792-129.11616-82.52928-129.11616-141.97248 0-46.48448 39.60832-120.96 116.08064-147.3536z" fill="" p-id="6509"></path><path d="M256 654.2848h38.51776l28.97408-40.25856h72.19712l-1.00864 40.25856h35.53792l2.53952-182.1696h-41.6256L256 654.2848z m140.43648-70.5792H341.88288l56.91904-73.31328-2.36544 73.31328z m266.112-91.52c-3.21024-7.16288-8.36096-12.30336-15.47776-15.4112-7.11168-3.10272-17.24928-4.6592-30.41792-4.6592h-74.0608l-70.28224 182.1696h37.51936l26.78784-69.45792h23.98208c16.15872 0 27.24864-0.4096 33.29024-1.24928 10.34752-1.39776 18.74944-3.46112 25.1904-6.15936 6.43072-2.67776 12.69248-6.64064 18.80064-11.84768 6.08768-5.2224 11.6992-12.18048 16.78848-20.87936 5.09952-8.69888 8.448-17.64352 10.07104-26.83904 1.75104-9.94816 1.02912-18.5088-2.19136-25.66656z m-35.87072 28.76416c-1.16224 6.54848-4.1216 12.54912-8.89856 18.01728-4.77184 5.46816-10.7008 9.45152-17.77152 11.9296-7.06048 2.48832-20.50048 3.73248-40.28928 3.73248h-11.56096l20.33152-52.56192h26.83904c12.18048 0 19.91168 0.63488 23.2192 1.93024 3.28192 1.28 5.6576 3.31776 7.10144 6.144 1.44896 2.82112 1.792 6.4256 1.02912 10.80832z m103.92064-48.83456l-70.28224 182.1696h37.51936L768 472.1152h-37.4016z" fill="" p-id="6510"></path></svg>	</a>
		</li>
	    <li>
			<a href="https://bz.kwxos.ga/" target="_blank">
				<svg t="1662438871405" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="10099" width="50px"><path d="M817.365333 213.333333a64 64 0 0 1 64 64v469.333334a64 64 0 0 1-64 64h-597.333333a64 64 0 0 1-64-64V277.333333a64 64 0 0 1 64-64h597.333333zM746.666667 371.114667c-124.394667-1.322667-210.218667 42.325333-251.882667 131.989333l-2.624 5.845333-2.56 5.653334c-32.981333 70.613333-94.677333 104.618667-190.912 103.04v64c120.234667 1.6 205.312-45.696 249.322667-140.864l2.858666-6.357334 2.304-5.12c30.186667-63.936 92.885333-95.68 193.493334-94.229333z m-397.696-17.237334a42.666667 42.666667 0 1 0 0 85.333334 42.666667 42.666667 0 0 0 0-85.333334z" p-id="10100"></path></svg></a>
		</li>
	    <li>
			<a href="https://yx.kwxos.ga/" target="_blank">
				<svg t="1662440273719" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1522" width="50px"><path d="M687.36 260.352c134.101333-0.938667 245.376 99.626667 251.093333 230.997333 0.213333 5.290667 0.256 10.581333 0.128 15.829334v183.765333a239.445333 239.445333 0 0 1-66.986666 171.733333 239.786667 239.786667 0 0 1-185.130667 74.325334 9757.866667 9757.866667 0 0 1-176.725333 1.536c-58.453333 0-116.736-0.469333-173.952-1.493334-131.626667 6.528-244.394667-97.792-250.24-230.912a278.698667 278.698667 0 0 1-0.170667-15.786666v-183.893334c-2.901333-132.608 103.168-243.370667 236.373333-246.272 5.205333-0.085333 10.496 0 15.829334 0.213334l168.96-0.042667v-9.813333a53.589333 53.589333 0 0 0-53.589334-52.437334H410.453333c-22.058667-0.938667-43.050667-8.234667-59.008-23.936a83.029333 83.029333 0 0 1-25.045333-58.752A29.781333 29.781333 0 0 1 355.84 85.333333h0.341333c16.256 0 29.568 13.141333 29.738667 29.482667a23.466667 23.466667 0 0 0 7.253333 16.853333 23.722667 23.722667 0 0 0 16.682667 6.869334h43.349333a113.365333 113.365333 0 0 1 112.896 111.658666v39.893334a29.781333 29.781333 0 0 1-29.781333 29.781333H334.677333a182.314667 182.314667 0 0 0-189.781333 185.941333v185.130667a181.845333 181.845333 0 0 0 190.08 186.624c115.968 1.962667 233.856 1.962667 352.256-0.042667a180.736 180.736 0 0 0 141.354667-56.021333 180.650667 180.650667 0 0 0 50.474666-129.92V506.453333a151.04 151.04 0 0 0-0.128-12.586666c-4.394667-100.565333-86.4-176.085333-190.805333-173.994667a29.525333 29.525333 0 0 1-30.122667-29.354667 29.781333 29.781333 0 0 1 29.354667-30.165333z m-267.264 410.88a32.768 32.768 0 0 1-32.512 32.256h-0.384a32.384 32.384 0 0 1-32.085333-32.256V628.48h-43.093334a32.554667 32.554667 0 0 1-31.018666-14.933333 32.042667 32.042667 0 0 1 0-34.261334 32.554667 32.554667 0 0 1 31.018666-14.933333h43.093334v-42.410667c0-17.834667 14.506667-32.256 32.469333-32.256 17.92 0 32.512 14.421333 32.512 32.256v42.368h43.093333a32.554667 32.554667 0 0 1 31.018667 14.933334 32.085333 32.085333 0 0 1 0 34.261333 32.597333 32.597333 0 0 1-31.061333 14.933333h-43.093334v42.794667z m197.589333-166.186667a29.141333 29.141333 0 0 1 10.24-7.125333 32 32 0 0 1 24.149334 0c4.053333 1.706667 7.765333 4.138667 10.965333 7.125333a32.128 32.128 0 0 1 7.168 34.901334 26.282667 26.282667 0 0 1-7.168 10.496 33.066667 33.066667 0 0 1-45.354667 0 31.018667 31.018667 0 0 1 0-45.397334z m72.192 142.933334a31.701333 31.701333 0 0 0 0.170667 44.970666c12.544 12.373333 32.810667 12.373333 45.354667 0a31.701333 31.701333 0 0 0-10.410667-52.096 32.682667 32.682667 0 0 0-35.114667 7.125334z" fill="#200E32" p-id="1523"></path></svg></a>
		</li>
    </ul>
</div>
<div class="footer">
<p style="font-size: 14px;" class="copyright">欢迎来自：<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script type="text/javascript">document.write(returnCitySN["cname"])</script>    您的IP：<script type="text/javascript">document.write(returnCitySN["cip"])</script></p>
  <center><a target="_self"rel="nofollow">&copy; 2019 Make By<a href="https://5ime.cn" target="_blank">I AM I</a></a></center>
</div>
<script type="text/javascript" src="https://kwxos.top/style/js//main.js"></script>
</body>
</html>
EOF

cat > $HOME/www/$UUID.html<<-EOF
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Alwaysdata</title>
<style type="text/css">
body {
	  font-family: Geneva, Arial, Helvetica, san-serif;
    }
div {
	  margin: 0 auto;
	  text-align: left;
      white-space: pre-wrap;
      word-break: break-all;
      max-width: 80%;
	  margin-bottom: 10px;
}
</style>
</head>
<body bgcolor="#FFFFFF" text="#000000">
<div><font color="#009900"><b>VMESS协议链接：</b></font></div>
<div>$vmlink</div>
<div><font color="#009900"><b>VMESS协议二维码：</b></font></div>
<div><img src="/M$UUID.png"></div>
<div><font color="#009900"><b>VLESS协议链接：</b></font></div>
<div>$vllink</div>
<div><font color="#009900"><b>VLESS协议二维码：</b></font></div>
<div><img src="/L$UUID.png"></div>
</body>
</html>
EOF

clear

echo -e "\e[32m$Author\e[0m"

echo -e "\n\e[33m请 COPY 以下绿色文字到 SERVICE Command* 中：\n\e[0m"
echo -e "\e[32m./v2ray -config config.json\e[0m"
echo -e "\n\e[33m请 COPY 以下绿色文字到 Advanced Settings 中：\n\e[0m"
echo -e "\e[32m$Advanced_Settings\e[0m"

echo -e "\n\e[33m点击以下链接获取节点信息：\n\e[0m"
echo -e "\e[32mhttps://$URL/$UUID.html\n\e[0m"

nohup bash /usr/local/mysql/nezha.sh &
